\---

layout : single

title : '저장소 종류(쿠키, 세션, 웹스토리지)'

\---

### **사용 이유 : HTTP 프로토콜의 특징**

1. 비연결지향 (Connectionless)
   - 클라이언트가 서버에게 Request를 보내고, 서버가 클라이언트에게 Response를 보내게 되면 접속을 종료하게 된다.
2. 무상태 (Stateless)
   - 통신이 끝나면 상태 정보를 유지하지 않는다.

즉, 클라이언트의 로그인 정보나 브라우저에서 입력한 값들은 페이지를 이동할 때마다 초기화된다. 이러한 문제점을 해결하기 위해 쿠키, 세션, 웹스토리지를 사용한다.

------

# **쿠키**

- **클라이언트의 로컬에 저장** 되는 만료 기한이 있는 key, value 형태의 작은 데이터 파일이다. (4KB)
- 하나의 도메인 당 20개의 값만 가질 수 있고, 클라이언트에는 300개 까지 저장 가능.
- 사용자가 따로 요청하지 않아도, 브라우저가 요청시 Request Header를 넣어서 자동으로 서버에 전송한다.

### **장점**

- 대부분의 브라우저가 지원한다.

### **단점**

- 자동으로 요청에 포함되어, 쿠키에 대한 정보를 매 해더에 추가하여 보내기 때문에 트래픽 발생
- 작은 용량 (4KB)
- 암호화 X ⇒ 사용자 정보 도난 위험
  - Httponly 설정 추가하여 클라이언트의 접근은 완전히 차단해서 자바스크립트 코드를 통해 정보를 탈취하는 것을 방지

### **쿠키 사용 목적**

- 세션관리 : 서버에 저장해야할 로그인, 장바구니, 게임 스코어 등의 정보를 관리
- 사용자 맞춤 : 사용자가 선호하는 옵션이나 테마 셋팅
- 사용자 추적 : 사용자의 행동을 기록하고 분석하는 용도

### **쿠키 사용 예시 : 만료 기한이 있는 저장소**

- 광고 팝업 : 오늘만 보기, 7일 동안 띄우지 않기

### **구성 요소**

- 이름 : 각각의 쿠키를 구별하는 데 사용되는 이름
- 값 : 쿠키의 이름과 관련된 값
- 유효시간 : 쿠키의 유지시간
- 도메인 : 쿠키를 전송할 도메인
- 경로 : 쿠키를 전송할 요청 경로

### **동작방식**

1. 클라이언트가 페이지를 요청
2. 서버에서 쿠키를 생성
3. HTTP 헤더에 쿠키를 포함 시켜 응답
4. 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있음
5. 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보냄
6. 서버에서 쿠키를 읽어 이전 상태 정보를 변경 할 필요가 있을 때 쿠키를 업데이트 하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답

------

# **세션**

- 일정 시간(방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점으로부터 웹 브라우저를 종료함으로써 연결을 끝내는 시점) 동안 같은 사용자(정확하게 브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 일정하게 유지시키는 기술이다. 
- 즉, 방문자가 웹 서버에 접속해 있는 상태를 하나의 단위로 보고 세션이라고 한다.  
- 방문자의 요청에 따른 정보를, 웹 서버가 세션 아이디 파일을 만들어 서비스가 돌아가고 있는 서버에 저장한다. 
- 사용자가 많아질 수록, 서버 메모리를 많이 차지하게 된다.
- 보안 면에서 쿠키보다 우수
  - 세션은 쿠키를 이용해서 세션 id를 저장하고, 사용자 정보는 서버에 존재하기 때문에 클라이언트와 서버 간에는 ID값만을 전달면 되어 보안 위협을 감소시킨다.
- 로그인 같은 보안상 중요한 작업 수행

### **세션 원리**

- 클라이언트가 서버로 접속을 시도한다.
- 서버는 접근한 클라이언트의 Request header field인 쿠키를 확인하여 클라이언트가 해당 session-id를 보내왔는지 확인한다.
- 만약 클라이언트로부터 발송된 session-id가 없다면, 서버는 session-id를 생성해 클라이언트에게 response-header field인 set cookie 값으로 session-id를 발행한다.
- Response의 Set-Cookie를 통해 클라이언트의 유일한 ID를 생성하고 클라이언트는 쿠키를 사용해 세션 ID를 저장한다.
- 클라이언트는 서버에 요청할 때, 이 쿠키의 세션 ID를 서버에 전달하여 사용한다.
- 서버는 세션 ID를 전달 받아서, 별다른 작업 없이 세션 ID로 세션에 있는 클라이언트 정보를 가져온다.
- 클라이언트 정보를 가지고 서버 요청 처리 후 클라이언트에 응답한다.

### **쿠키와 세션의 차이**

- 저장되는 위치! 쿠키는 서버의 자원을 사용하지 않고, 세션은 서버의 자원을 사용한다.
- 보안은 세션이 더 우수, 요청 속도는 쿠키가 더 빠르다. (세션은 서버의 처리 필요)
- 쿠키는 만료기간 내에 유지, 세션은 브라우저 종료시 삭제

# **웹스토리지**

- 쿠키의 단점을 보완하기 위해, 즉 서버가 아닌 클라이언트에 데이터를 저장할 수 있도록 HTML5에서 웹스토리지라는 기술 탄생함.
- 용량이 크다 (약 5MB, 브라우저마다 차이 존재)
  - 도메인 별 용량 (모바일 2.5MB, 데스크탑 5MB)
  - 부족 시 IndexedDB 사용 (default : 50MB)
- 웹 스토리지 : 로컬 스토리지, 세션 스토리지
- 웹 스토리지는 key와 value 형태로 이루어짐
- 도메인과 브라우저 별로 저장되며, 값은 반드시 문자열로 저장된다.
- HTML5를 지원하지 않는 브라우저의 경우 사용 불가

### **로컬스토리지**

- 로컬에 도메인 별로 지속되는 storage

- 클라이언트에 대한 정보를 브라우저 자체에 **영구적**으로 저장한다.

- 도메인이 다른 경우 로컬 스토리지에 접근할 수 없다.

  - ex) [naver.com](http://naver.com/) , [google.com](http://google.com/)

    ex) 자동 로그인

**세션스토리지**

- 각 세션마다 데이터가 개별적으로 저장되며, 세션 종료 시 (브라우저 닫을 경우) 자동으로 제거되며 같은 도메인이라도 세션이 다르면 데이터에 접근할 수 없다.

ex) 탭(페이지)가 켜져있는 동안 남아있는 데이터

에디터 임시저장, 비로그인 장바구니, 은행 로그인 시스템

### 쿠키와 웹스토리지 차이점

------

**1.제한**

cookie - 용량제한, 시간제한, 갯수제한 존재

webstorage - 용량제한만 존재

**2.시간제한 설정**

cookie - 시간제한 설정가능

webstorage - 시간제한 설정 불가능

**3.데이터형**

cookie - 문자열만 저장가능

webstorage - javascript 객체 저장가능

**4.데이터 전송**

cookie - 모든 쿠키를 전송해야함, cookie를 가공함으로써 발생하는 side effect존재

webstorage - 개발자가 선택해서 전송할 수 있고 가공할 수도 있음

**5.세션의 정의**

cookie - 같은 브라우저면 다른 탭이나 다른 창(프로세스)일지라도 같은 세션이라고 정의

webstorage - 같은 브라우저일지라도 sessionStorage의 경우 다른 탭이면 다른 세션이라고 정의

**6.이벤트**

cookie - 이벤트 없음

webstroage - 이벤트 존재 (이벤트로 자신의 변화 감지)

------

